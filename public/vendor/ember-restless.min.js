(function(p,v,c,n){function q(a){return c.computed(function(b,d){var c=this.get("_data");1===arguments.length?(d=c[b],d===n&&(d="function"===typeof a.defaultValue?a.defaultValue():a.defaultValue,c[b]=d)):d!==c[b]&&(c[b]=d,a.readOnly||e.ReadOnlyModel.detectInstance(this)||this._onPropertyChange(b));return d}).property("_data").meta(a)}var f=c.get,e;e===n&&(e=c.Namespace.create(),p!==n&&(p.RL=p.RESTless=e));e.attr=function(a,b){var d=c.merge({type:a,isAttribute:!0},b);return q(d)};e.belongsTo=function(a,
b){var d=c.merge({type:a,isRelationship:!0,belongsTo:!0},b);return q(d)};e.hasMany=function(a,b){var d=c.merge({type:a,isRelationship:!0,hasMany:!0,defaultValue:function(){return e.RecordArray.createWithContent()}},b);return q(d)};e.Serializer=c.Object.extend({dataType:null,contentType:null,deserialize:c.K,deserializeProperty:c.K,deserializeMany:c.K,serialize:c.K,serializeProperty:c.K,serializeMany:c.K,prepareData:function(a){return a},parseError:function(a){return a}});e.JSONSerializer=e.Serializer.extend({dataType:"json",
contentType:"application/json; charset=utf-8",deserialize:function(a,b){if(!b)return a;var d,g;d=this._keyForResource(a);b[d]&&(b=b[d]);c.beginPropertyChanges(a);for(g in b)b.hasOwnProperty(g)&&this.deserializeProperty(a,g,b[g]);c.endPropertyChanges(a);return a},deserializeProperty:function(a,b,d){b=this.attributeNameForKey(a,b);var g=f(a.constructor,"fields").get(b),k,h;g&&(k=g.type,h=f(c.lookup,k),g.hasMany?d=this.deserializeMany(a.get(b),k,d):g.belongsTo&&h?(d=h.create({isNew:!1}).deserialize(d),
d.onLoaded()):k&&e.JSONTransforms[k]&&(d=e.JSONTransforms[k].deserialize(d)),a.set(b,d))},deserializeMany:function(a,b,d){if(!d)return a;var g=f(c.lookup,b),k,h;(k=this.extractMeta(d))&&a.set("meta",k);if(!c.isArray(d))if(b=this._keyPluralForResourceType(b),d[b])d=d[b];else return a;a?a.clear():a=e.RecordArray.createWithContent();if(b=d.length){c.beginPropertyChanges(a);for(k=0;k<b;k++)h=d[k],g&&"object"===typeof h&&(h=g.create({isNew:!1}).deserialize(h)),a.pushObject(h);c.endPropertyChanges(a)}a.onLoaded();
return a},serialize:function(a,b){var d={};f(a.constructor,"fields").forEach(function(c,g){if(!g.readOnly&&(!g.belongsTo||g.belongsTo&&b&&b.includeRelationships)){var e=this.serializeProperty(a,c,g);null!==e&&(d[this.keyForAttributeName(c)]=e)}},this);if(b&&b.nonEmbedded)return d;var c={};c[this._keyForResource(a)]=d;return c},serializeProperty:function(a,b,d){var c=a.get(b);d||(d=a.constructor.metaForProperty(b));if(d&&d.hasMany)return this.serializeMany(c.get("content"),d.type);if(d.belongsTo)return this.serialize(c);
d.type&&e.JSONTransforms[d.type]&&(c=e.JSONTransforms[d.type].serialize(c));return c},serializeMany:function(a,b){var d=this._keyForResourceType(b),c=a.length,k=[],h,f;for(h=0;h<c;h++)f=a[h],e.Model.detectInstance(f)&&(f=f.serialize()),k.push(f[d]);return k},_keyForResource:function(a){return this.keyForResourceName(f(a.constructor,"resourceName"))},_keyForResourceType:function(a){return(a=f(c.lookup,a))?this._keyForResource(a.create()):null},_keyPluralForResourceType:function(a){var b=f(c.lookup,
a);return b?(a=f(b,"adapter"),b=f(b,"resourceName"),a.pluralize(this.keyForResourceName(b))):null},keyForResourceName:function(a){return a?c.String.decamelize(a):null},keyForAttributeName:function(a){return a?c.String.decamelize(a):null},attributeNameForKey:function(a,b){var d=f(e,"client._modelConfigs").get(a.constructor.toString());return d&&d.propertyKeys&&d.propertyKeys[b]?d.propertyKeys[b]:c.String.camelize(b)},prepareData:function(a){return JSON.stringify(a)},parseError:function(a){var b=null;
try{b=JSON.parse(a)}catch(d){}return b},extractMeta:function(a){if(a&&a.meta)return a.meta},registerTransform:function(a,b){e.JSONTransforms[a]=b}});e.JSONTransforms={};e.Adapter=c.Object.extend({serializer:null,saveRecord:c.K,deleteRecord:c.K,findAll:c.K,findQuery:c.K,findByKey:c.K,generateIdForRecord:c.K,find:function(a,b){var d=f(a,"primaryKey");if("string"===typeof b||"number"===typeof b||"object"===typeof b&&b.hasOwnProperty(d)){if(!b.hasOwnProperty(d))return this.findByKey(a,b);var c=b[d];delete b[d];
return this.findByKey(a,c,b)}return this.findQuery(a,b)},fetch:function(a,b){var d=this,g;return new c.RSVP.Promise(function(c,e){g=d.find(a,b);g.one("didLoad",function(a){c(a)});g.one("becameError",function(a){e(a)})})},reloadRecord:function(a){var b=a.constructor,d=f(b,"primaryKey");a=a.get(d);return c.isNone(a)?new c.RSVP.Promise(function(a,b){b(null)}):this.fetch(b,a)},configurations:c.Object.create({plurals:c.Object.create(),models:c.Map.create()}),configure:function(a,b){var d=this.get("configurations"),
g=d.get(a);g&&d.set(a,c.merge(g,b));return this},map:function(a,b){var d=this.get("configurations.models"),g=d.get(a),e={},f,l,m;for(f in b)b.hasOwnProperty(f)&&(b[f].hasOwnProperty("key")?(l=g&&g.hasOwnProperty("propertyKeys")?g.propertyKeys:{},m=b[f].key,l[m]=f,e.propertyKeys=l):e[f]=b[f],g=g?c.merge(g,e):e);d.set(a,g);return this},pluralize:function(a){var b=this.get("configurations.plurals");return b&&b[a]||a+"s"}});e.RESTAdapter=e.Adapter.extend({serializer:e.JSONSerializer.create(),url:null,
namespace:null,useContentTypeExtension:!1,rootPath:c.computed(function(){var a=document.createElement("a"),b=this.get("url"),d=this.get("namespace"),c=d&&"/"===d.charAt(0);a.href=b?b:"";d&&(a.pathname=c?d:a.pathname+d);return a.href.replace(/\/+$/,"")}).property("url","namespace"),resourcePath:function(a){return this.pluralize(c.String.decamelize(a))},request:function(a,b,d){var g=this,e=this.serializer;return new c.RSVP.Promise(function(f,l){b=b||{};b.url=g.buildUrl(a,d);b.dataType=e.dataType;b.contentType=
e.contentType;b.data&&"GET"!==b.type&&(b.data=e.prepareData(b.data));b.success=function(a,b,d){c.run(null,f,a)};b.error=function(a,b,d){a=g.parseAjaxErrors(a,b,d);c.run(null,l,a)};var m=c.$.ajax(b);a.set("currentRequest",m)})},buildUrl:function(a,b){var d=this.resourcePath(f(a.constructor,"resourceName")),c=f(a.constructor,"primaryKey"),e=[this.get("rootPath"),d],d=this.get("serializer.dataType");b?e.push(b):a.get(c)&&e.push(a.get(c));c=e.join("/");this.get("useContentTypeExtension")&&d&&(c+="."+
d);return c},saveRecord:function(a){var b=a.get("isNew"),d;if(!b&&!a.get("isDirty"))return new c.RSVP.Promise(function(b,d){b(a)});a.set("isSaving",!0);d=this.request(a,{type:b?"POST":"PUT",data:a.serialize()});d.then(function(d){d&&a.deserialize(d);a.onSaved(b);return a},function(b){a.onError(b);return b});return d},deleteRecord:function(a){var b=this.request(a,{type:"DELETE",data:a.serialize()});b.then(function(){a.onDeleted();return null},function(b){a.onError(b);return b});return b},reloadRecord:function(a){var b=
f(a.constructor,"primaryKey"),b=a.get(b);if(c.isNone(b))return new c.RSVP.Promise(function(a,b){b(null)});a.set("isLoaded",!1);b=this.request(a,{type:"GET"},b);b.then(function(b){a.deserialize(b);a.onLoaded()},function(b){a.onError(b)});return b},findAll:function(a){return this.findQuery(a)},findQuery:function(a,b){var d=a.toString(),c=a.create({isNew:!1}),f=e.RecordArray.createWithContent();this.request(c,{type:"GET",data:b}).then(function(a){f.deserializeMany(d,a);f.onLoaded()},function(a){f.onError(a)});
return f},findByKey:function(a,b,d){var c=a.create({isNew:!1});this.request(c,{type:"GET",data:d},b).then(function(a){c.deserialize(a);c.onLoaded()},function(a){c.onError(a)});return c},fetch:function(a,b){var d=this,e,f;f=new c.RSVP.Promise(function(c,f){e=d.find(a,b);e.one("didLoad",function(a){c(a)});e.one("becameError",function(a){f(a)})});f._currentRequest=e.get("currentRequest");return f},parseAjaxErrors:function(a,b,c){var e=this.get("serializer").parseError(a.responseText)||{};e.status=a.status;
e.state=a.state();e.textStatus=b;e.errorThrown=c;return e},registerTransform:function(a,b){this.get("serializer").registerTransform(a,b)}});e.Client=c.Object.extend({adapter:e.RESTAdapter.create(),_modelConfigs:c.computed.alias("adapter.configurations.models")});c.onLoad("Ember.Application",function(a){a.initializer({name:"Client",initialize:function(a,c){c.Client?e.set("client",c.Client):e.set("client",e.Client.create());c.addObserver("Client",this,function(){e.set("client",this.Client)})}})});e.State=
c.Mixin.create(c.Evented,{isNew:!0,isLoaded:!1,isDirty:!1,isSaving:!1,isError:!1,_isReady:!1,errors:null,didCreate:c.K,didUpdate:c.K,didLoad:c.K,didDelete:c.K,becameError:c.K,onSaved:function(a){this.setProperties({isDirty:!1,isSaving:!1,isLoaded:!0,isError:!1,errors:null});this._triggerEvent(a?"didCreate":"didUpdate",this);this._triggerEvent("didLoad",this)},onDeleted:function(){this._triggerEvent("didDelete",this);c.run.next(this,function(){this.destroy()})},onLoaded:function(){this.setProperties({isLoaded:!0,
isError:!1,errors:null});this._triggerEvent("didLoad",this)},onError:function(a){this.setProperties({isSaving:!1,isError:!0,errors:a});this._triggerEvent("becameError",a)},clearErrors:function(){this.setProperties({isError:!1,errors:null});return this},copyState:function(a){var b=e.State.mixins,b=b[b.length-1].properties;c.beginPropertyChanges(a);for(var d in b)b.hasOwnProperty(d)&&"function"!==typeof b[d]&&a.set(d,this.get(d));c.endPropertyChanges(a);return a},_triggerEvent:function(a,b){c.run(this,
function(){c.tryInvoke(this,a,[b]);this.trigger(a,b)})}});e.Model=c.Object.extend(e.State,c.Copyable,{id:e.attr("number"),__data:null,_data:c.computed(function(){this.__data||(this.__data={});return this.__data}),didDefineProperty:function(a,b,d){d instanceof c.Descriptor&&d.meta().isRelationship&&c.addObserver(a,b+".isDirty",null,"_onRelationshipChange")},_onPropertyChange:function(a){var b=this.get("isNew");b&&f(this.constructor,"primaryKey")===a&&(this.set("isNew",!1),b=!1);this.get("_isReady")&&
(b||this.get("isLoaded"))&&this.set("isDirty",!0)},_onRelationshipChange:function(a,b){a.get(b)&&this._onPropertyChange(b)},copy:function(a){var b=this.constructor.create();a=f(this.constructor,"fields");c.beginPropertyChanges(this);a.forEach(function(a,c){var e=this.get(a);null!==e&&b.set(a,e)},this);c.endPropertyChanges(this);return b},copyWithState:function(a){return this.copyState(this.copy(a))},saveRecord:function(){return f(this.constructor,"adapter").saveRecord(this)},deleteRecord:function(){return f(this.constructor,
"adapter").deleteRecord(this)},reloadRecord:function(){return f(this.constructor,"adapter").reloadRecord(this)},serialize:function(a){return e.get("client.adapter.serializer").serialize(this,a)},deserialize:function(a){return e.get("client.adapter.serializer").deserialize(this,a)},serializeProperty:function(a){return e.get("client.adapter.serializer").serializeProperty(this,a)},deserializeProperty:function(a,b){return e.get("client.adapter.serializer").deserializeProperty(this,a,b)}});e.Model.reopenClass({create:function(){var a=
this._super.apply(this,arguments);a.set("_isReady",!0);return a},createRecord:c.aliasMethod("create"),adapter:c.computed(function(){return f(e,"client.adapter")}).property("RESTless.client.adapter"),primaryKey:c.computed(function(){var a=this.toString();return(a=f(e,"client._modelConfigs").get(a))&&a.primaryKey?a.primaryKey:"id"}).property("RESTless.client._modelConfigs"),resourceName:c.computed(function(){var a=this.toString().split(".");return a[a.length-1]}),fields:c.computed(function(){var a=
c.Map.create();this.eachComputedProperty(function(b,c){(c.isAttribute||c.isRelationship)&&a.set(b,c)});return a}),find:function(a){return f(this,"adapter").find(this,a)},fetch:function(a){return f(this,"adapter").fetch(this,a)},findAll:function(){return f(this,"adapter").findAll(this)},findQuery:function(a){return f(this,"adapter").findQuery(this,a)},findByKey:function(a,b){return f(this,"adapter").findByKey(this,a,b)},findById:c.aliasMethod("findByKey"),load:function(a){a=this.create().set("_isReady",
!1).deserialize(a).set("_isReady",!0);a.onLoaded();return a},loadMany:function(a){a=e.RecordArray.createWithContent().deserializeMany(this.toString(),a);a.onLoaded();return a}});e.ReadOnlyModel=e.Model.extend({serialize:null,saveRecord:null,deleteRecord:null,didDefineProperty:null,_onPropertyChange:c.K});e.RecordArray=c.ArrayProxy.extend(e.State,{adapter:c.computed(function(){return f(e,"client.adapter")}).property("RESTless.client.adapter"),deserializeMany:function(a,b){return f(this,"adapter.serializer").deserializeMany(this,
a,b)},serializeMany:function(a){return f(this,"adapter.serializer").serializeMany(this,a)},replaceContent:function(a,b,c){f(this,"content").replace(a,b,c);this.get("isLoaded")&&this.set("isDirty",!0)},_onItemDirtyChange:c.observer(function(){var a=this.get("content").everyProperty("isDirty",!1);this.get("isLoaded")&&!a&&this.set("isDirty",!0)},"@each.isDirty"),_onLoadedChange:c.observer(function(){this.get("isLoaded")&&this.forEach(function(a){if(e.Model.detectInstance(a))a.onLoaded()})},"isLoaded")});
e.RecordArray.reopenClass({create:function(){return this._super.apply(this,arguments).setProperties({_isReady:!0,isNew:!1})},createWithContent:function(){var a=this.create.apply(this,arguments);a.content||a.set("content",c.A());return a}});c.Date=c.Date||{};var r=Date.parse,u=[1,4,5,6,7,10,11];c.Date.parse=function(a){var b,c=0;if(b=/^(\d{4}|[+\-]\d{6})(?:-(\d{2})(?:-(\d{2}))?)?(?:T(\d{2}):(\d{2})(?::(\d{2})(?:\.(\d{3}))?)?(?:(Z)|([+\-])(\d{2})(?::(\d{2}))?)?)?$/.exec(a)){a=0;for(var e;e=u[a];++a)b[e]=
+b[e]||0;b[2]=(+b[2]||1)-1;b[3]=+b[3]||1;"Z"!==b[8]&&b[9]!==n&&(c=60*b[10]+b[11],"+"===b[9]&&(c=0-c));b=Date.UTC(b[1],b[2],b[3],b[4],b[5]+c,b[6],b[7])}else b=r?r(a):NaN;return b};if(!0===c.EXTEND_PROTOTYPES||c.EXTEND_PROTOTYPES.Date)Date.parse=c.Date.parse;var s=c.isNone,t=c.isEmpty;e.JSONTransforms={string:{deserialize:function(a){return s(a)?null:String(a)},serialize:function(a){return s(a)?null:String(a)}},number:{deserialize:function(a){return t(a)?null:Number(a)},serialize:function(a){return t(a)?
null:Number(a)}},"boolean":{deserialize:function(a){var b=typeof a;return"boolean"===b?a:"string"===b?null!==a.match(/^true$|^t$|^1$/i):"number"===b?1===a:!1},serialize:function(a){return Boolean(a)}},date:{deserialize:function(a){var b=typeof a;return"string"===b?new Date(c.Date.parse(a)):"number"===b?new Date(a):null===a||a===n?a:null},serialize:function(a){if(a instanceof Date){var b=function(a){return 10>a?"0"+a:""+a},c=a.getUTCFullYear(),e=a.getUTCMonth(),f=a.getUTCDate(),h=a.getUTCDay(),l=a.getUTCHours(),
m=a.getUTCMinutes();a=a.getUTCSeconds();h="Sun Mon Tue Wed Thu Fri Sat".split(" ")[h];f=b(f);return h+", "+f+" "+"Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" ")[e]+" "+c+" "+b(l)+":"+b(m)+":"+b(a)+" GMT"}return null}}}})(this,jQuery,Ember);
